<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Darts Checkout App & Scorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .result-item, .feedback-item {
            opacity: 0;
            transform: translateY(10px);
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        input::placeholder { color: #9ca3af; opacity: 1; }
        .mode-button-active { background-color: #dc2626; color: white; }
        .mode-button-inactive { background-color: #e5e7eb; color: #374151; }
        .hidden { display: none; }
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        .current-player-highlight { background-color: #dcfce7; border: 2px solid #86efac; }
        button:disabled { background-color: #d1d5db; cursor: not-allowed; }
        button:disabled:hover { background-color: #d1d5db; }
        input[type="radio"]:checked + label {
            background-color: #10b981; /* Emerald-500 */
            color: white;
            border-color: #059669; /* Emerald-600 */
        }
        .difficulty-label {
             font-size: 0.8rem;
             padding: 0.4rem 0.6rem;
        }
        .setting-label {
            font-size: 0.875rem; /* text-sm */
            margin-bottom: 0.25rem; /* mb-1 */
        }
        .setting-input {
            padding: 0.5rem 0.75rem; /* py-2 px-3 */
            font-size: 0.875rem; /* text-sm */
        }
        .avg-text {
             font-size: 0.75rem; /* text-xs */
        }
        .keypad-button {
            @apply border border-gray-300 rounded-lg p-3 text-lg font-medium bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition duration-150 ease-in-out flex items-center justify-center;
        }
        /* Removed .choice-button @apply rule */
    </style>
</head>
<body class="p-4">

    <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg w-full max-w-lg mx-auto mb-24 sm:mb-0">
        <h1 class="text-xl sm:text-2xl font-bold text-center mb-4 text-gray-800">ðŸŽ¯ Darts Suite</h1>

        <div class="flex flex-wrap justify-center gap-2 mb-4">
            <button id="lookupModeBtn" type="button" class="mode-button mode-button-active px-3 py-1.5 rounded-lg font-medium transition duration-150 ease-in-out text-xs sm:text-sm">Checkout Lookup</button>
            <button id="gameModeBtn" type="button" class="mode-button mode-button-inactive px-3 py-1.5 rounded-lg font-medium transition duration-150 ease-in-out text-xs sm:text-sm">Practice Game</button>
            <button id="playMatchModeBtn" type="button" class="mode-button mode-button-inactive px-3 py-1.5 rounded-lg font-medium transition duration-150 ease-in-out text-xs sm:text-sm">Play Match</button>
        </div>

        <div id="lookupModeSection">
             <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 text-center">Find a Checkout</h2>
             <div class="mb-3">
                 <label for="scoreInputLookup" class="block text-sm font-medium text-gray-700 mb-1">Enter score remaining:</label>
                 <input type="number" id="scoreInputLookup" name="scoreInputLookup" placeholder="e.g., 100" class="numeric-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition duration-150 ease-in-out text-sm" inputmode="numeric" pattern="[0-9]*">
             </div>
             <button id="calculateBtnLookup" type="button" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 mb-4 text-sm sm:text-base">
                 Find Checkouts
             </button>
             <div id="resultsLookup" class="mt-3">
                 <h3 class="text-base sm:text-lg font-semibold text-gray-700 mb-2">Possible Checkouts:</h3>
                 <div id="checkoutListLookup" class="space-y-1.5 text-sm">
                     <p class="text-gray-500">Enter a score between 2 and 170.</p>
                 </div>
             </div>
             <div id="messageAreaLookup" class="mt-3 text-center text-red-500 font-medium text-sm"></div>
        </div>

        <div id="gameModeSection" class="hidden">
             <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 text-center">Practice Your Finishes!</h2>
             <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
                 <div>
                     <label for="minScoreInput" class="block text-sm font-medium text-gray-700 mb-1">Min Score:</label>
                     <input type="number" id="minScoreInput" name="minScoreInput" value="2" min="2" max="170" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out text-sm" inputmode="numeric">
                 </div>
                 <div>
                     <label for="maxScoreInput" class="block text-sm font-medium text-gray-700 mb-1">Max Score:</label>
                     <input type="number" id="maxScoreInput" name="maxScoreInput" value="170" min="2" max="170" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out text-sm" inputmode="numeric">
                 </div>
             </div>
             <p class="text-xs text-gray-500 text-center mb-3 -mt-2">Set range & click 'New Game'</p>
             <div class="text-center mb-3 p-3 bg-gray-100 rounded-lg">
                 <p class="text-sm font-medium text-gray-600">Score to checkout:</p>
                 <p id="gameScoreDisplay" class="text-2xl sm:text-3xl font-bold text-red-600">-</p>
             </div>
             <div class="mb-3">
                 <label for="scoreInputGame" class="block text-sm font-medium text-gray-700 mb-1">Your checkout attempt (e.g., T20, D20):</label>
                 <input type="text" id="scoreInputGame" name="scoreInputGame" placeholder="T20, D20 or T19 D16 etc." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out text-sm">
             </div>
             <div class="flex flex-col gap-2 mb-3">
                 <button id="submitAnswerBtn" type="button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm sm:text-base" disabled>
                     Check My Answer
                 </button>
                 <button id="revealAnswerBtn" type="button" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 text-sm sm:text-base" disabled>
                     Reveal Answer
                 </button>
             </div>
             <div id="feedbackAreaGame" class="mt-3 text-center font-medium min-h-[2em] text-sm"></div>
             <button id="newGameBtn" type="button" class="w-full mt-3 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 text-sm sm:text-base">
                 New Game
             </button>
        </div>

        <div id="playMatchChoiceSection" class="hidden">
             <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-4 text-center">Select Match Type</h2>
             <div class="flex flex-col sm:flex-row gap-3">
                 <button id="pvpBtn" type="button" class="w-full sm:w-auto flex-grow sm:flex-grow-0 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-semibold py-3 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm sm:text-base flex items-center justify-center">
                      <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 15v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path></svg>
                      Player vs Player
                 </button>
                 <button id="playPcBtn" type="button" class="w-full sm:w-auto flex-grow sm:flex-grow-0 bg-gradient-to-r from-teal-500 to-emerald-600 hover:from-teal-600 hover:to-emerald-700 text-white font-semibold py-3 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 text-sm sm:text-base flex items-center justify-center">
                      <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12.5a.5.5 0 01.5.5v1a.5.5 0 01-1 0v-1a.5.5 0 01.5-.5z"></path><path d="M10 2a1 1 0 00-1 1v1a1 1 0 002 0V3a1 1 0 00-1-1z"></path><path fill-rule="evenodd" d="M3 5a2 2 0 012-2h10a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V5zm2-1a1 1 0 00-1 1v10a1 1 0 001 1h10a1 1 0 001-1V5a1 1 0 00-1-1H5z" clip-rule="evenodd"></path></svg>
                      Player vs Computer
                 </button>
             </div>
        </div>

        <div id="pvpModeSection" class="hidden">
             <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 text-center">Player vs Player (501)</h2>
             <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-2">
                 <div>
                     <label for="player1NameInputPvp" class="block text-sm font-medium text-gray-700 mb-1">Player 1:</label>
                     <input type="text" id="player1NameInputPvp" value="Player 1" class="w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-150 ease-in-out text-sm">
                 </div>
                 <div>
                     <label for="player2NameInputPvp" class="block text-sm font-medium text-gray-700 mb-1">Player 2:</label>
                     <input type="text" id="player2NameInputPvp" value="Player 2" class="w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-150 ease-in-out text-sm">
                 </div>
             </div>
             <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-2">
                 <div id="player1DisplayPvp" class="p-2 border border-gray-200 rounded-lg text-center transition-colors duration-300">
                     <p id="player1NameDisplayPvp" class="font-semibold text-sm sm:text-base text-gray-800 truncate">Player 1</p>
                     <p id="player1ScorePvp" class="text-xl sm:text-2xl font-bold text-indigo-600">501</p>
                     <p class="avg-text text-gray-500 mt-0.5">(Wins: <span id="player1GamesWonPvp" class="font-medium">0</span>)</p>
                     <p class="avg-text text-gray-500 mt-0.5">Leg Avg: <span id="p1LegAvgPvp" class="font-medium">-</span></p>
                     <p class="avg-text text-gray-500">Overall Avg: <span id="p1OverallAvgPvp" class="font-medium">-</span></p>
                 </div>
                 <div id="player2DisplayPvp" class="p-2 border border-gray-200 rounded-lg text-center transition-colors duration-300">
                     <p id="player2NameDisplayPvp" class="font-semibold text-sm sm:text-base text-gray-800 truncate">Player 2</p>
                     <p id="player2ScorePvp" class="text-xl sm:text-2xl font-bold text-indigo-600">501</p>
                     <p class="avg-text text-gray-500 mt-0.5">(Wins: <span id="player2GamesWonPvp" class="font-medium">0</span>)</p>
                     <p class="avg-text text-gray-500 mt-0.5">Leg Avg: <span id="p2LegAvgPvp" class="font-medium">-</span></p>
                     <p class="avg-text text-gray-500">Overall Avg: <span id="p2OverallAvgPvp" class="font-medium">-</span></p>
                 </div>
             </div>
             <p id="currentPlayerIndicatorPvp" class="text-center font-semibold text-gray-700 mb-2 text-sm">Current Player: -</p>
             <div class="mb-2">
                 <label for="turnScoreInputPvp" class="block text-sm font-medium text-gray-700 mb-1">Enter score this turn (0-180):</label>
                 <input type="number" id="turnScoreInputPvp" name="turnScoreInputPvp" placeholder="e.g., 100" class="numeric-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-150 ease-in-out text-sm" inputmode="numeric" pattern="[0-9]*" min="0" max="180">
             </div>
             <div class="flex flex-col sm:flex-row gap-2 mb-2">
                 <button id="submitTurnScoreBtnPvp" type="button" class="flex-grow w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 text-sm sm:text-base">
                     Submit Score
                 </button>
                 <button id="undoTurnBtnPvp" type="button" class="w-full sm:w-auto bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 text-sm sm:text-base" disabled>
                     Undo
                 </button>
             </div>
             <div id="messageAreaPvp" class="mt-2 text-center font-medium min-h-[1.8em] text-sm"></div>
             <div id="checkoutSuggestionPvp" class="mt-1 text-center text-sm"></div>
             <button id="resetPvpGameBtn" type="button" class="w-full mt-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 text-sm sm:text-base">
                 Reset Leg
             </button>
        </div>

        <div id="vsComputerModeSection" class="hidden">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 text-center">Play vs Computer</h2>

            <div id="vsCompSetupArea" class="mb-3 border-b pb-3">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
                     <div>
                         <label for="startScoreInputVsComp" class="setting-label block font-medium text-gray-700">Starting Score:</label>
                         <input type="number" id="startScoreInputVsComp" value="501" min="101" step="100" class="setting-input w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition duration-150 ease-in-out">
                     </div>
                     <div>
                         <label for="legsToWinInputVsComp" class="setting-label block font-medium text-gray-700">First to (Legs):</label>
                         <input type="number" id="legsToWinInputVsComp" value="3" min="1" class="setting-input w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition duration-150 ease-in-out">
                     </div>
                </div>

                <div id="difficultySelectionArea">
                    <label class="block text-sm font-medium text-gray-700 mb-2 text-center">Select Difficulty Level (1-10):</label>
                    <div class="grid grid-cols-3 sm:grid-cols-5 gap-1 justify-center">
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff1" value="1" class="sr-only"> <label for="diff1" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">1</label> </div>
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff2" value="2" class="sr-only"> <label for="diff2" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">2</label> </div>
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff3" value="3" class="sr-only"> <label for="diff3" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">3</label> </div>
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff4" value="4" class="sr-only"> <label for="diff4" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">4</label> </div>
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff5" value="5" class="sr-only" checked> <label for="diff5" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">5</label> </div>
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff6" value="6" class="sr-only"> <label for="diff6" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">6</label> </div>
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff7" value="7" class="sr-only"> <label for="diff7" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">7</label> </div>
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff8" value="8" class="sr-only"> <label for="diff8" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">8</label> </div>
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff9" value="9" class="sr-only"> <label for="diff9" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">9</label> </div>
                        <div class="text-center"> <input type="radio" name="difficulty" id="diff10" value="10" class="sr-only"> <label for="diff10" class="difficulty-label block border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-150 ease-in-out">10</label> </div>
                    </div>
                </div>
            </div>

            <button id="startVsCompGameBtn" type="button" class="w-full my-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 text-sm sm:text-base">
                Start Match
            </button>

            <div id="vsCompScoreDisplay" class="hidden">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-2">
                    <div id="player1DisplayVsComp" class="p-2 border border-gray-200 rounded-lg text-center transition-colors duration-300">
                        <p id="player1NameDisplayVsComp" class="font-semibold text-sm sm:text-base text-gray-800 truncate">You</p>
                        <p id="player1ScoreVsComp" class="text-xl sm:text-2xl font-bold text-indigo-600">501</p>
                        <p class="avg-text text-gray-500 mt-0.5">(<span id="player1GamesWonVsComp" class="font-medium">0</span> / <span id="targetLegsVsComp">3</span> Legs)</p>
                        <p class="avg-text text-gray-500 mt-0.5">Leg Avg: <span id="legAvgDisplayVsComp" class="font-medium">-</span></p>
                        <p class="avg-text text-gray-500">Overall Avg: <span id="overallAvgDisplayVsComp" class="font-medium">-</span></p>
                    </div>
                    <div id="player2DisplayVsComp" class="p-2 border border-gray-200 rounded-lg text-center transition-colors duration-300">
                        <p id="player2NameDisplayVsComp" class="font-semibold text-sm sm:text-base text-gray-800 truncate">Computer</p>
                        <p id="player2ScoreVsComp" class="text-xl sm:text-2xl font-bold text-indigo-600">501</p>
                        <p class="avg-text text-gray-500 mt-0.5">(<span id="player2GamesWonVsComp" class="font-medium">0</span> / <span id="targetLegsVsComp2">3</span> Legs)</p>
                        <p class="avg-text text-gray-500 mt-0.5">Leg Avg: <span id="compLegAvgDisplayVsComp" class="font-medium">-</span></p>
                        <p class="avg-text text-gray-500">Overall Avg: <span id="compOverallAvgDisplayVsComp" class="font-medium">-</span></p>
                    </div>
                </div>
                <p id="currentPlayerIndicatorVsComp" class="text-center font-semibold text-gray-700 mb-2 text-sm">Current Player: -</p>
                <div class="mb-2">
                    <label for="turnScoreInputVsComp" class="block text-sm font-medium text-gray-700 mb-1">Enter your score this turn (0-180):</label>
                    <input type="number" id="turnScoreInputVsComp" name="turnScoreInputVsComp" placeholder="e.g., 100" class="numeric-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-150 ease-in-out text-sm" inputmode="numeric" pattern="[0-9]*" min="0" max="180">
                </div>
                <div class="flex flex-col sm:flex-row gap-2 mb-2">
                    <button id="submitTurnScoreBtnVsComp" type="button" class="flex-grow w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 text-sm sm:text-base">
                        Submit Score
                    </button>
                </div>
                <div id="messageAreaVsComp" class="mt-2 text-center font-medium min-h-[1.8em] text-sm"></div>
                <div id="checkoutSuggestionVsComp" class="mt-1 text-center text-sm"></div>
                <button id="resetVsCompGameBtn" type="button" class="w-full mt-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 text-sm sm:text-base">
                    Reset Match
                </button>
            </div>
        </div>

        <div id="numericKeypad" class="hidden sm:hidden fixed bottom-0 left-0 right-0 bg-gray-200 p-2 shadow-lg border-t border-gray-300 z-50">
            <div class="grid grid-cols-3 gap-2">
                <button type="button" class="keypad-button keypad-num">7</button>
                <button type="button" class="keypad-button keypad-num">8</button>
                <button type="button" class="keypad-button keypad-num">9</button>
                <button type="button" class="keypad-button keypad-num">4</button>
                <button type="button" class="keypad-button keypad-num">5</button>
                <button type="button" class="keypad-button keypad-num">6</button>
                <button type="button" class="keypad-button keypad-num">1</button>
                <button type="button" class="keypad-button keypad-num">2</button>
                <button type="button" class="keypad-button keypad-num">3</button>
                <button type="button" id="keypadBackspace" class="keypad-button text-red-600">âŒ«</button>
                <button type="button" class="keypad-button keypad-num">0</button>
                <button type="button" id="keypadEnter" class="keypad-button text-green-600">â†µ</button>
            </div>
        </div>

    </div>

    <script>
        // --- Checkout Data (Standard Finishes) ---
        const checkouts = { /* ... data unchanged ... */ };
        const impossibleCheckouts = [169, 168, 166, 165, 163, 162, 159];
        let finishableScores = [];

        // --- DOM Elements ---
        const lookupModeBtn = document.getElementById('lookupModeBtn');
        const gameModeBtn = document.getElementById('gameModeBtn');
        const playMatchModeBtn = document.getElementById('playMatchModeBtn');
        const lookupModeSection = document.getElementById('lookupModeSection');
        const gameModeSection = document.getElementById('gameModeSection');
        const playMatchChoiceSection = document.getElementById('playMatchChoiceSection');
        const pvpBtn = document.getElementById('pvpBtn');
        const playPcBtn = document.getElementById('playPcBtn');
        const pvpModeSection = document.getElementById('pvpModeSection');
        const vsComputerModeSection = document.getElementById('vsComputerModeSection');
        // Lookup Elements
        const scoreInputLookup = document.getElementById('scoreInputLookup');
        const calculateBtnLookup = document.getElementById('calculateBtnLookup');
        const checkoutListLookup = document.getElementById('checkoutListLookup');
        const messageAreaLookup = document.getElementById('messageAreaLookup');
        // Practice Elements
        const minScoreInput = document.getElementById('minScoreInput');
        const maxScoreInput = document.getElementById('maxScoreInput');
        const gameScoreDisplay = document.getElementById('gameScoreDisplay');
        const scoreInputGame = document.getElementById('scoreInputGame');
        const submitAnswerBtn = document.getElementById('submitAnswerBtn');
        const revealAnswerBtn = document.getElementById('revealAnswerBtn');
        const feedbackAreaGame = document.getElementById('feedbackAreaGame');
        const newGameBtn = document.getElementById('newGameBtn');
        // PvP (Tracker) Elements
        const player1NameInputPvp = document.getElementById('player1NameInputPvp');
        const player2NameInputPvp = document.getElementById('player2NameInputPvp');
        const player1NameDisplayPvp = document.getElementById('player1NameDisplayPvp');
        const player2NameDisplayPvp = document.getElementById('player2NameDisplayPvp');
        const player1ScorePvp = document.getElementById('player1ScorePvp');
        const player2ScorePvp = document.getElementById('player2ScorePvp');
        const player1GamesWonPvp = document.getElementById('player1GamesWonPvp');
        const player2GamesWonPvp = document.getElementById('player2GamesWonPvp');
        const player1DisplayPvp = document.getElementById('player1DisplayPvp');
        const player2DisplayPvp = document.getElementById('player2DisplayPvp');
        const p1LegAvgPvp = document.getElementById('p1LegAvgPvp');
        const p1OverallAvgPvp = document.getElementById('p1OverallAvgPvp');
        const p2LegAvgPvp = document.getElementById('p2LegAvgPvp');
        const p2OverallAvgPvp = document.getElementById('p2OverallAvgPvp');
        const currentPlayerIndicatorPvp = document.getElementById('currentPlayerIndicatorPvp');
        const turnScoreInputPvp = document.getElementById('turnScoreInputPvp');
        const submitTurnScoreBtnPvp = document.getElementById('submitTurnScoreBtnPvp');
        const undoTurnBtnPvp = document.getElementById('undoTurnBtnPvp');
        const messageAreaPvp = document.getElementById('messageAreaPvp');
        const checkoutSuggestionPvp = document.getElementById('checkoutSuggestionPvp');
        const resetPvpGameBtn = document.getElementById('resetPvpGameBtn');
        // Vs Comp Setup Elements
        const vsCompSetupArea = document.getElementById('vsCompSetupArea');
        const startScoreInputVsComp = document.getElementById('startScoreInputVsComp');
        const legsToWinInputVsComp = document.getElementById('legsToWinInputVsComp');
        const difficultySelectionArea = document.getElementById('difficultySelectionArea');
        const difficultyRadios = document.querySelectorAll('input[name="difficulty"]');
        const startVsCompGameBtn = document.getElementById('startVsCompGameBtn');
        // Vs Comp Gameplay Elements
        const vsCompScoreDisplay = document.getElementById('vsCompScoreDisplay');
        const player1DisplayVsComp = document.getElementById('player1DisplayVsComp');
        const player2DisplayVsComp = document.getElementById('player2DisplayVsComp');
        const player1NameDisplayVsComp = document.getElementById('player1NameDisplayVsComp');
        const player2NameDisplayVsComp = document.getElementById('player2NameDisplayVsComp');
        const player1ScoreVsComp = document.getElementById('player1ScoreVsComp');
        const player2ScoreVsComp = document.getElementById('player2ScoreVsComp');
        const player1GamesWonVsComp = document.getElementById('player1GamesWonVsComp');
        const player2GamesWonVsComp = document.getElementById('player2GamesWonVsComp');
        const targetLegsVsComp = document.getElementById('targetLegsVsComp');
        const targetLegsVsComp2 = document.getElementById('targetLegsVsComp2');
        const legAvgDisplayVsComp = document.getElementById('legAvgDisplayVsComp');
        const overallAvgDisplayVsComp = document.getElementById('overallAvgDisplayVsComp');
        const compLegAvgDisplayVsComp = document.getElementById('compLegAvgDisplayVsComp');
        const compOverallAvgDisplayVsComp = document.getElementById('compOverallAvgDisplayVsComp');
        const currentPlayerIndicatorVsComp = document.getElementById('currentPlayerIndicatorVsComp');
        const turnScoreInputVsComp = document.getElementById('turnScoreInputVsComp');
        const submitTurnScoreBtnVsComp = document.getElementById('submitTurnScoreBtnVsComp');
        const messageAreaVsComp = document.getElementById('messageAreaVsComp');
        const checkoutSuggestionVsComp = document.getElementById('checkoutSuggestionVsComp');
        const resetVsCompGameBtn = document.getElementById('resetVsCompGameBtn');
        // Keypad Elements
        const numericKeypad = document.getElementById('numericKeypad');
        const keypadButtons = numericKeypad?.querySelectorAll('.keypad-button');
        const keypadBackspace = document.getElementById('keypadBackspace');
        const keypadEnter = document.getElementById('keypadEnter');
        const numericInputs = document.querySelectorAll('.numeric-input');

        // --- State ---
        let currentMode = 'lookup'; // 'lookup', 'practice', 'matchChoice', 'pvp', 'vsComp'
        let currentGameScore = 0; // Practice mode score
        // Shared 501 Game State (Tracker & VsComp)
        let playerNames = ["Player 1", "Player 2"]; // Will be updated based on mode
        let playerScores = [501, 501];
        let playerGamesWonTally = [0, 0]; // Legs won in current match
        let currentPlayerIndex = 0;
        let legStartingPlayerIndex = 0;
        let legWon = false;
        let matchWon = false; // Flag for Vs Comp match end
        // PvP (Tracker) Specific State
        let lastPlayerScores = null; // For undo
        let lastPlayerIndex = null; // For undo
        let lastGamesWonTally = null; // For undo
        let undoPossible = false;
        let nextLegTimeoutId = null;
        // PvP Average Tracking State
        let p1TotalScore = 0, p1TotalTurns = 0, p1LegScore = 0, p1LegTurns = 0;
        let p2TotalScore = 0, p2TotalTurns = 0, p2LegScore = 0, p2LegTurns = 0;
        // Vs Computer Specific State
        let vsCompDifficulty = 5; // Default difficulty level (1-10)
        let computerTurnTimeoutId = null;
        let startScore = 501; // Configurable start score (used by both modes now)
        let legsToWin = 3; // Configurable legs to win (VsComp only for now)
        // VsComp Average Tracking State
        let humanTotalScoreVsComp = 0; // Renamed to avoid clash if we make PvP overall avg separate later
        let humanTotalTurnsVsComp = 0;
        let humanLegScoreVsComp = 0;
        let humanLegTurnsVsComp = 0;
        let computerTotalScore = 0;
        let computerTotalTurns = 0;
        let computerLegScore = 0;
        let computerLegTurns = 0;
        // Keypad State
        let activeNumericInput = null;

        // --- Constants ---
        const COMPUTER_TURN_DELAY = 1000;
        const DEFAULT_START_SCORE = 501;

        // --- Functions ---

        /** Populates the finishableScores array */
        function initializeGameData() { /* ...unchanged... */ }

        /** Starts a new practice game */
        function startNewPracticeGame() { /* ...unchanged... */ }

        /** Checks the practice game answer */
        function checkPracticeAnswer() { /* ...unchanged... */ }

        /** Reveals the practice game answer */
        function revealAnswer() { /* ...unchanged... */ }

        /** Displays feedback messages */
        function displayGameFeedback(message, type, areaElement) { /* ...unchanged... */ }

        /** Displays checkout lookup results */
        function displayLookupCheckouts() { /* ...unchanged... */ }

        // --- Shared 501 / Vs Comp / PvP Functions ---

        /** Resets the game state for the current mode */
        function resetGame() { /* ...unchanged... */ }

        /** Starts the next leg for the current 501-based mode */
        function startNextLeg() { /* ...unchanged... */ }

        /** Updates the visual highlight for the current player */
        function updateCurrentPlayerIndicator() { /* ...unchanged... */ }

        /** Handles score submission for PvP OR Human player in Vs Comp */
        function submitTurnScore() {
            if (legWon || matchWon) return;

            const isVsComp = currentMode === 'vsComp';
            const isPvp = currentMode === 'pvp';

            const turnInput = isVsComp ? turnScoreInputVsComp : (isPvp ? turnScoreInputPvp : null);
            const messageArea = isVsComp ? messageAreaVsComp : (isPvp ? messageAreaPvp : null);
            const suggestionArea = isVsComp ? checkoutSuggestionVsComp : (isPvp ? checkoutSuggestionPvp : null);
            const submitBtn = isVsComp ? submitTurnScoreBtnVsComp : (isPvp ? submitTurnScoreBtnPvp : null);
            const undoBtn = isPvp ? undoTurnBtnPvp : null;

            if (!turnInput || !messageArea || !suggestionArea || !submitBtn) { console.error("Missing elements for submitting turn score!"); return; }

            const playerIndex = currentPlayerIndex;
            messageArea.textContent = ''; suggestionArea.innerHTML = '';

            const enteredScoreText = turnInput.value;
            const enteredScore = parseInt(enteredScoreText);
            if (isNaN(enteredScore) || enteredScore < 0 || enteredScore > 180) {
                messageArea.textContent = 'Invalid score. Please enter 0-180.';
                turnInput.select(); return;
            }

            // Store state for potential undo (PvP mode only)
            if (isPvp) {
                lastPlayerScores = [...playerScores]; lastPlayerIndex = currentPlayerIndex; lastGamesWonTally = [...playerGamesWonTally];
                undoPossible = true; if(undoBtn) undoBtn.disabled = false;
            }

            // Update averages - count turn regardless of bust
            if (isVsComp && playerIndex === 0) { // Human in Vs Comp
                humanLegTurns++; humanTotalTurns++;
            } else if (isPvp) { // Player 1 or 2 in PvP
                if (playerIndex === 0) { p1LegTurns++; p1TotalTurns++; }
                else { p2LegTurns++; p2TotalTurns++; }
            }

            let currentScore = playerScores[playerIndex];
            const potentialScore = currentScore - enteredScore;

            // Check for Bust
            if (potentialScore < 2 && potentialScore !== 0) {
                messageArea.textContent = `${playerNames[playerIndex]} Bust! Score remains ${currentScore}.`;
                 // Update average displays even on bust
                 if (isVsComp && playerIndex === 0) updateAverageDisplays();
                 else if (isPvp) updatePvpAverageDisplays();
            } else { // Valid score or win
                playerScores[playerIndex] = potentialScore;
                // Update score display
                if (isVsComp && playerIndex === 0) { if(player1ScoreVsComp) player1ScoreVsComp.textContent = potentialScore; }
                else if (isPvp) {
                    const scoreEl = (playerIndex === 0) ? player1ScorePvp : player2ScorePvp;
                    if(scoreEl) scoreEl.textContent = potentialScore;
                }

                 // Add score to averages only if valid
                 if (isVsComp && playerIndex === 0) {
                     humanLegScore += enteredScore; humanTotalScore += enteredScore; updateAverageDisplays();
                 } else if (isPvp) {
                     if (playerIndex === 0) { p1LegScore += enteredScore; p1TotalScore += enteredScore; }
                     else { p2LegScore += enteredScore; p2TotalScore += enteredScore; }
                     updatePvpAverageDisplays();
                 }

                messageArea.textContent = `${playerNames[playerIndex]} scored ${enteredScore}. Remaining: ${potentialScore}`;

                // Check for Leg Win
                if (potentialScore === 0) {
                    legWon = true;
                    playerGamesWonTally[playerIndex]++;
                    // Update wins display
                    if (isVsComp) { if(player1GamesWonVsComp) player1GamesWonVsComp.textContent = playerGamesWonTally[playerIndex]; }
                    else if (isPvp) {
                        const winsEl = (playerIndex === 0) ? player1GamesWonPvp : player2GamesWonPvp;
                        if(winsEl) winsEl.textContent = playerGamesWonTally[playerIndex];
                    }

                    // Check for Match Win (Vs Comp only)
                    if (isVsComp && playerGamesWonTally[playerIndex] >= legsToWin) {
                        matchWon = true;
                        const winColor = playerIndex === 0 ? 'green' : 'red';
                        displayGameFeedback(`MATCH WON by ${playerNames[playerIndex]}! (${playerGamesWonTally[0]} - ${playerGamesWonTally[1]})`, winColor, messageArea);
                        turnInput.disabled = true; submitBtn.disabled = true;
                    } else {
                        // Leg won, but match continues (or single leg in PvP)
                        const winColor = 'green';
                        displayGameFeedback(`GAME SHOT! Leg to ${playerNames[playerIndex]}! Starting next leg in 2s...`, winColor, messageArea);
                        turnInput.disabled = true; submitBtn.disabled = true; if (isPvp && undoBtn) undoBtn.disabled = true;
                        nextLegTimeoutId = setTimeout(startNextLeg, 2000);
                    }
                    return; // Exit function early after win
                }
            }

            // If no win, switch Player
            currentPlayerIndex = (currentPlayerIndex + 1) % 2;
            updateCurrentPlayerIndicator();
            turnInput.value = '';

            if (isVsComp && currentPlayerIndex === 1) { // Vs Comp: Trigger computer's turn
                turnInput.disabled = true; submitBtn.disabled = true;
                triggerComputerTurn();
            } else { // PvP or Human's turn in VsComp: Show suggestion for next player
                displayCheckoutSuggestion(playerScores[currentPlayerIndex], suggestionArea);
                turnInput.focus();
            }
        }

        /** Undoes the last turn in PvP mode */
        function undoLastTurn() { /* ...unchanged... */ }

        /** Displays checkout suggestion if applicable */
        function displayCheckoutSuggestion(score, suggestionArea) { /* ...unchanged... */ }

        // --- Vs Computer Specific Functions ---

        /** Sets up the UI for Vs Computer mode */
        function setupVsComputerUI() { /* ...unchanged... */ }

        /** Starts a new game against the computer */
        function startVsComputerGame() { /* ...unchanged... */ }

        /** Updates the human average displays */
        function updateAverageDisplays() { /* ... Corrected average calculation ... */ }

         /** Updates the computer average displays */
        function updateComputerAverageDisplays() { /* ... Corrected average calculation ... */ }

         /** Updates the PvP average displays */
         function updatePvpAverageDisplays() { /* ... Corrected average calculation ... */ }


        /** Generates a score for the computer based on difficulty level (1-10) */
        function generateComputerScore(remainingScore) { /* ...unchanged... */ }

        /** Handles the computer's turn */
        function computerTurn() { /* ...unchanged... */ }

        /** Wrapper to trigger computer turn with delay */
        function triggerComputerTurn() { /* ...unchanged... */ }


        // --- Mode Switching ---
        /** Switches between the different modes */
        function switchMode(modeToSwitchTo) {
            console.log(`Switching mode to: ${modeToSwitchTo}`);

            // Hide all sections first - Added null checks
            if(lookupModeSection) lookupModeSection.classList.add('hidden');
            if(gameModeSection) gameModeSection.classList.add('hidden');
            if(pvpModeSection) pvpModeSection.classList.add('hidden');
            if(vsComputerModeSection) vsComputerModeSection.classList.add('hidden');
            if(playMatchChoiceSection) playMatchChoiceSection.classList.add('hidden');

            // Deactivate all top-level mode buttons
            if(lookupModeBtn) lookupModeBtn.classList.replace('mode-button-active', 'mode-button-inactive');
            if(gameModeBtn) gameModeBtn.classList.replace('mode-button-active', 'mode-button-inactive');
            if(playMatchModeBtn) playMatchModeBtn.classList.replace('mode-button-active', 'mode-button-inactive');

            // Clear any pending timers
            if (nextLegTimeoutId) { clearTimeout(nextLegTimeoutId); nextLegTimeoutId = null; }
            if (computerTurnTimeoutId) { clearTimeout(computerTurnTimeoutId); computerTurnTimeoutId = null; }

            hideKeypad(); // Hide keypad whenever mode changes

            let focusElement = null;
            // Set currentMode *after* potential resets triggered by other modes
            currentMode = modeToSwitchTo;

            switch (modeToSwitchTo) {
                case 'lookup':
                    if(lookupModeSection) lookupModeSection.classList.remove('hidden');
                    if(lookupModeBtn) lookupModeBtn.classList.replace('mode-button-inactive', 'mode-button-active');
                    focusElement = scoreInputLookup;
                    break;
                case 'game': // Practice Game
                    if(gameModeSection) gameModeSection.classList.remove('hidden');
                    if(gameModeBtn) gameModeBtn.classList.replace('mode-button-inactive', 'mode-button-active');
                    startNewPracticeGame();
                    focusElement = scoreInputGame;
                    break;
                case 'playMatch': // Show choice screen
                     if(playMatchChoiceSection) playMatchChoiceSection.classList.remove('hidden');
                     if(playMatchModeBtn) playMatchModeBtn.classList.replace('mode-button-inactive', 'mode-button-active');
                     focusElement = pvpBtn; // Focus first choice button
                     break;
                // 'pvp' and 'vsComp' modes are now entered via listeners on pvpBtn and playPcBtn
                default: // Default to lookup
                    currentMode = 'lookup';
                    if(lookupModeSection) lookupModeSection.classList.remove('hidden');
                    if(lookupModeBtn) lookupModeBtn.classList.replace('mode-button-inactive', 'mode-button-active');
                    focusElement = scoreInputLookup;
                    break;
            }
            // Focus logic
            if (focusElement && typeof focusElement.focus === 'function' && !focusElement.disabled) { setTimeout(() => focusElement.focus(), 50); }
            else if (focusElement && focusElement.nodeName === 'LABEL') { const radioId = focusElement.getAttribute('for'); const radioToFocus = document.getElementById(radioId); if (radioToFocus && typeof radioToFocus.focus === 'function') { setTimeout(() => radioToFocus.focus(), 50); } }
        }

        // --- Keypad Functions ---
        function showKeypad() { /* ...unchanged... */ }
        function hideKeypad() { /* ...unchanged... */ }
        function handleKeypadInput(event) { /* ...unchanged... */ }
        function handleBackspace() { /* ...unchanged... */ }
        function handleEnter() { /* ...unchanged... */ }


        // --- Event Listeners ---
        if(lookupModeBtn) lookupModeBtn.addEventListener('click', () => switchMode('lookup'));
        if(gameModeBtn) gameModeBtn.addEventListener('click', () => switchMode('game'));
        if(playMatchModeBtn) playMatchModeBtn.addEventListener('click', () => switchMode('playMatch'));

        // Listeners for sub-mode choices
        if(pvpBtn) pvpBtn.addEventListener('click', () => {
            currentMode = 'pvp'; // Set mode
            if(playMatchChoiceSection) playMatchChoiceSection.classList.add('hidden');
            if(pvpModeSection) pvpModeSection.classList.remove('hidden');
            if(playMatchModeBtn) playMatchModeBtn.classList.replace('mode-button-inactive', 'mode-button-active'); // Keep parent button active
            resetGame(); // Reset/Setup PvP game
        });
         if(playPcBtn) playPcBtn.addEventListener('click', () => {
            currentMode = 'vsComp'; // Set mode
            if(playMatchChoiceSection) playMatchChoiceSection.classList.add('hidden');
            if(vsComputerModeSection) vsComputerModeSection.classList.remove('hidden');
             if(playMatchModeBtn) playMatchModeBtn.classList.replace('mode-button-inactive', 'mode-button-active'); // Keep parent button active
            resetGame(); // Reset/Setup VsComp game (shows setup screen)
        });


        if(calculateBtnLookup) calculateBtnLookup.addEventListener('click', displayLookupCheckouts);
        if(scoreInputLookup) { scoreInputLookup.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); calculateBtnLookup.click(); } }); scoreInputLookup.addEventListener('input', () => { if(messageAreaLookup) messageAreaLookup.textContent = ''; }); }
        if(submitAnswerBtn) submitAnswerBtn.addEventListener('click', checkPracticeAnswer);
        if(revealAnswerBtn) revealAnswerBtn.addEventListener('click', revealAnswer);
        if(newGameBtn) newGameBtn.addEventListener('click', startNewPracticeGame);
        if(scoreInputGame) { scoreInputGame.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); if (!submitAnswerBtn.disabled) submitAnswerBtn.click(); } }); scoreInputGame.addEventListener('input', () => { if (!submitAnswerBtn.disabled && feedbackAreaGame) { feedbackAreaGame.innerHTML = ''; feedbackAreaGame.className = 'mt-4 text-center font-medium min-h-[2em] text-sm'; } }); }
        // PvP Listeners (formerly tracker)
        if(submitTurnScoreBtnPvp) submitTurnScoreBtnPvp.addEventListener('click', submitTurnScore);
        if(resetPvpGameBtn) resetPvpGameBtn.addEventListener('click', resetGame);
        if(undoTurnBtnPvp) undoTurnBtnPvp.addEventListener('click', undoLastTurn);
        if(turnScoreInputPvp) turnScoreInputPvp.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); if (!submitTurnScoreBtnPvp.disabled && !legWon) submitTurnScoreBtnPvp.click(); } });
        if(player1NameInputPvp) player1NameInputPvp.addEventListener('input', (e) => { const n = e.target.value || "Player 1"; if(player1NameDisplayPvp) player1NameDisplayPvp.textContent = n; playerNames[0] = n; if(currentMode === 'pvp') updateCurrentPlayerIndicator(); });
        if(player2NameInputPvp) player2NameInputPvp.addEventListener('input', (e) => { const n = e.target.value || "Player 2"; if(player2NameDisplayPvp) player2NameDisplayPvp.textContent = n; playerNames[1] = n; if(currentMode === 'pvp') updateCurrentPlayerIndicator(); });
        // Vs Comp Listeners
        if(difficultyRadios) difficultyRadios.forEach(radio => { radio.addEventListener('change', (e) => { vsCompDifficulty = parseInt(e.target.value); console.log(`Difficulty set to Level: ${vsCompDifficulty}`); }); });
        if(startVsCompGameBtn) startVsCompGameBtn.addEventListener('click', startVsComputerGame);
        if(submitTurnScoreBtnVsComp) submitTurnScoreBtnVsComp.addEventListener('click', submitTurnScore);
        if(resetVsCompGameBtn) resetVsCompGameBtn.addEventListener('click', resetGame);
        if(turnScoreInputVsComp) turnScoreInputVsComp.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); if (!submitTurnScoreBtnVsComp.disabled && !legWon && !matchWon) submitTurnScoreBtnVsComp.click(); } });

        // Keypad Listeners
        if (keypadButtons) {
            keypadButtons.forEach(button => {
                if (button.classList.contains('keypad-num')) { button.addEventListener('click', handleKeypadInput); }
                else if (button.id === 'keypadBackspace') { button.addEventListener('click', handleBackspace); }
                else if (button.id === 'keypadEnter') { button.addEventListener('click', handleEnter); }
            });
        }
        // Listen for focus on numeric inputs to show keypad
        if (numericInputs) {
            numericInputs.forEach(input => {
                input.addEventListener('focus', (e) => { activeNumericInput = e.target; if (window.innerWidth < 640) { showKeypad(); } });
                 input.addEventListener('blur', (e) => { setTimeout(() => { if (numericKeypad && !numericKeypad.contains(document.activeElement)) { hideKeypad(); } }, 50); });
            });
        }

        // --- Initialization ---
        initializeGameData();
        resetGame(); // Initialize shared game state
        switchMode('lookup'); // Start in lookup mode

    </script>
</body>
</html>
